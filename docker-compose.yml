services:
  model-designer:
    image: ghcr.io/kittawat-thongpud/model-designer:sha-925f089
    container_name: model-designer

    # ── Ports ──────────────────────────────────────────────────────────────────
    ports:
      - "8000:8000"

    # ── RunPod Network Volume ──────────────────────────────────────────────────
    # RunPod mounts the network volume at /workspace on the host.
    # Mount the ENTIRE /workspace so the project, venv, and data all persist.
    #
    # First boot layout (auto-created by entrypoint.sh):
    #   /workspace/Model_DESIGNER/  ← git clone + venv
    #   /workspace/data/            ← datasets, weights, jobs, logs
    volumes:
      - /workspace:/workspace

    # ── Environment ────────────────────────────────────────────────────────────
    environment:
      - APP_DIR=/workspace/Model_DESIGNER
      - DATA_DIR=/workspace/data
      - GIT_REPO=https://github.com/kittawat-thongpud/Model_DESIGNER
      - GIT_BRANCH=main
      - PYTHONUNBUFFERED=1

    # ── GPU ────────────────────────────────────────────────────────────────────
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

    restart: unless-stopped
